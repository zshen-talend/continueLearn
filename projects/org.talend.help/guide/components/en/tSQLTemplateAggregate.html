<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>tSQLTemplateAggregate</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title="Talend Open Studio"><link rel="up" href="Raa48933-dup-2.html" title="Chapter&nbsp;7.&nbsp;ELT components"><link rel="prev" href="tELTTeradataOutput.html" title="tELTTeradataOutput"><link rel="next" href="tSQLTemplateCommit.html" title="tSQLTemplateCommit"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="EN" class="section" title="tSQLTemplateAggregate"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tSQLTemplateAggregate"></a>tSQLTemplateAggregate</h2></div></div></div><div class="mediaobject"><img src="../images/tSQLTemplateAggregate_icon32_white.png"></div><div class="section" title="tSQLTemplateAggregate properties"><div class="titlepage"><div><div><h3 class="title"><a name="d0e183487"></a>tSQLTemplateAggregate properties</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col class="c1"><col class="c2"><col class="c3"></colgroup><tbody><tr><td valign="top">
									<p>
										<span class="bold"><strong>Component family</strong></span>
									</p>
								</td><td valign="top">
									<p>ELT/SQLTemplate</p>
								</td><td valign="top">&nbsp;</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>Function</strong></span>
									</p>
								</td><td colspan="2" valign="top">
									<p><span class="bold"><strong>tSQLTemplateAggregate</strong></span>
										collects data values from one or more columns with the
										intent to manage the collection as a single unit. This
										component has real-time capabilities since it runs the data
										transformation on the DBMS itself.</p>
								</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>Purpose</strong></span>
									</p>
								</td><td colspan="2" valign="top">
									<p>Helps to provide a set of matrix based on values or
										calculations. </p>
								</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>Basic settings</strong></span>
									</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Database Type</em></span>
									</p>
								</td><td valign="top">
									<p>Select the database type you want to connect to from the
										list.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Component List</em></span>
									</p>
								</td><td valign="top">
									<p>Select the relevant DB connection component in the list if
										you use more than one connection in the current Job.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Database name</em></span>
									</p>
								</td><td valign="top">
									<p>Name of the database.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Source table name</em></span>
									</p>
								</td><td valign="top">
									<p>Name of the table holding the data you want to collect
										values from.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Target table name</em></span>
									</p>
								</td><td valign="top">
									<p>Name of the table you want to write the collected and
										transformed data in.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="emphasis"><em>Schema</em></span> and <span class="emphasis"><em>Edit
											schema</em></span></p>
								</td><td valign="top">
									<p>A schema is a row description, i.e., it defines the number
										of fields that will be processed and passed on to the next
										component. The schema is either built-in or remote in the
										Repository. </p>
									<p> Click <span class="bold"><strong>Edit Schema </strong></span>to
										make changes to the schema. Note that if you make changes,
										the schema automatically becomes built-in.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Built-in</strong></span>: You create and
										store the schema locally for this component only. Related
										topic: see <span class="bluebold">Talend Open Studio</span>
										<span class="bold"><strong>User Guide</strong></span>.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Repository</strong></span>: You have
										already created the schema and stored it in the Repository.
										You can reuse it in various projects and Job flowcharts.
										Related topic: see <span class="bluebold">Talend Open Studio</span>
										<span class="bold"><strong>User Guide</strong></span></p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Operations</em></span>
									</p>
								</td><td valign="top">
									<p>Select the type of operation along with the value to use
										for the calculation and the output field.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Output Column</strong></span>: Select the
										destination field in the list.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Function</strong></span>: Select any of
										the following operations to perform on data: <span class="bold"><strong>count</strong></span>, <span class="bold"><strong>min</strong></span>, <span class="bold"><strong>max</strong></span>,
											<span class="bold"><strong>avg</strong></span>, <span class="bold"><strong>sum</strong></span>, and <span class="bold"><strong>count</strong></span><span class="bold"><strong>
											(distinct)</strong></span>.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Input column position</strong></span>:
										Select the input column from which you want to collect the
										values to be aggregated.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>Group by</em></span>
									</p>
								</td><td valign="top">
									<p>Define the aggregation sets, the values of which will be
										used for calculations.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Output Column</strong></span>: Select the
										column label in the list offered according to the schema
										structure you defined. You can add as many output columns as
										you wish to make more precise aggregations.</p>
								</td></tr><tr><td>
									<p>&nbsp;</p>
								</td><td>
									<p>&nbsp;</p>
								</td><td valign="top">
									<p><span class="bold"><strong>Input Column position</strong></span>:
										Match the input column label with your output columns, in
										case the output label of the aggregation set needs to be
										different.</p>
								</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>Advanced settings</strong></span>
									</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>tStatCatcher Statistics</em></span>
									</p>
								</td><td valign="top">
									<p>Select this check box to gather the Job processing
										metadata at a Job level as well as at each component
										level.</p>
								</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>SQL Template</strong></span>
									</p>
								</td><td valign="top">
									<p>
										<span class="emphasis"><em>SQL Template List</em></span>
									</p>
								</td><td valign="top">
									<p><span class="bold"><strong>To add a default system SQL
											template: </strong></span>Click the <span class="bold"><strong>Add</strong></span> button to add the default system SQL
										template(s) in the <span class="bold"><strong>SQL
											</strong></span><span class="bold"><strong>Template</strong></span><span class="bold"><strong>
											List</strong></span>. </p>
									<p> Click in the SQL template field and then click the arrow
										to display the system SQL template list. Select the desired
										system SQL template provided by <span class="bold"><strong>Talend</strong></span>. </p>
									<p>
										<span class="bold"><strong>Note:</strong></span> You can create your
										own SQL template and add them to the <span class="bold"><strong>SQL Template List</strong></span>. </p>
									<p> </p>
									<p>
										<span class="bold"><strong>To create a user-defined SQL
											template:</strong></span>
									</p>
									<p> -Select a system template from the <span class="bold"><strong>SQL Template list</strong></span> and click on its code in
										the code box. You will be prompted by the system to create a
										new template.</p>
									<p> -Click <span class="bold"><strong>Yes</strong></span> to open the
										SQL template wizard.</p>
									<p> -Define your new SQL template in the corresponding fields
										and click <span class="bold"><strong>Finish</strong></span> to close
										the wizard. An SQL template editor opens where you can enter
										the template code.</p>
									<p> -Click the <span class="bold"><strong>Add</strong></span> button to
										add the new created template to the <span class="bold"><strong>SQL Template list</strong></span>.</p>
									<p> For more information, see <span class="bluebold">Talend Open Studio</span>
										<span class="bold"><strong>User Guide</strong></span>.</p>
								</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>Usage</strong></span>
									</p>
								</td><td colspan="2" valign="top">
									<p>This component is used as an intermediate component with
										other relevant DB components, especially the DB connection
										and commit components.</p>
								</td></tr><tr><td valign="top">
									<p>
										<span class="bold"><strong>Limitation</strong></span>
									</p>
								</td><td colspan="2" valign="top">
									<p>n/a</p>
								</td></tr></tbody></table></div></div><div class="section" title="Scenario: Filtering and aggregating table columns directly on the DBMS"><div class="titlepage"><div><div><h3 class="title"><a name="Raa22184"></a>Scenario: Filtering and aggregating table columns directly on the
					DBMS</h3></div></div></div><p>The following Java scenario creates a Job that opens a connection to a Mysql
					database and:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>instantiates the schemas from a database table whose rows match the
							column names specified in the filter,</p></li><li class="listitem"><p>filters a column in the same database table to have only the data that
							matches a WHERE clause,</p></li><li class="listitem"><p>collects data grouped by specific value(s) from the filtered column
							and writes aggregated data in a target database table.</p></li></ul></div><p>To filter and aggregate database table columns:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Drop the following components from the <span class="bold"><strong>Palette</strong></span> onto the design workspace: <span class="bold"><strong>tELTMysqlconnection</strong></span>, <span class="bold"><strong>tSQLTemplateFilterColumns</strong></span>, <span class="bold"><strong>tSQLTemplateFilterRows</strong></span>, <span class="bold"><strong>tSQLTemplateAggregate</strong></span>, <span class="bold"><strong>tSQLTemplateCommit</strong></span>, and <span class="bold"><strong>tSQLTemplateRollback</strong></span>.</p></li><li class="listitem"><p>Connect the five first components using <span class="bold"><strong>OnComponentOk </strong></span>links.</p></li><li class="listitem"><p>Connect <span class="bold"><strong>tSQLTemplateAggregate</strong></span> to
								<span class="bold"><strong>tSQLTemplateRollback</strong></span> using an
								<span class="bold"><strong>OnComponentError</strong></span> link.</p></li></ul></div><div class="mediaobject"><img src="../images/Use_Case_tSQLTemplateAggregate1.png"></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the design workspace, select <span class="bold"><strong>tMysqlConnection</strong></span> and click the <span class="bold"><strong>Component</strong></span> tab to define the basic settings for <span class="bold"><strong>tMysqlConnection</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold"><strong>Basic settings</strong></span> view, set the
							database connection details manually or select <span class="bold"><strong>Repository</strong></span> from the <span class="bold"><strong>Property
								Type</strong></span> list and select your DB connection if it has already
							been defined and stored in the <span class="bold"><strong>Metadata</strong></span>
							area of the <span class="bold"><strong>Repository</strong></span> tree view.
						</p></li></ul></div><p>For more information about Metadata, see <span class="bluebold">Talend Open Studio</span>
					<span class="bold"><strong>User Guide</strong></span>.</p><div class="mediaobject"><img src="../images/Use_Case_tSQLTemplateAggregate2.png"></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the design workspace, select <span class="bold"><strong>tSQLTemplateFilterColumns</strong></span> and click the <span class="bold"><strong>Component</strong></span> tab to define its basic
							settings.</p></li></ul></div><div class="mediaobject"><img src="../images/Use_Case_tSQLTemplateAggregate3.png"></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>On the <span class="bold"><strong>Database type</strong></span> list, select the
							relevant database.</p></li><li class="listitem"><p>On the <span class="bold"><strong>Component list</strong></span>, select the
							relevant database connection component if more than one connection is
							used.</p></li><li class="listitem"><p>Enter the names for the database, source table, and target table in
							the corresponding fields and click the three-dot buttons next to
								<span class="bold"><strong>Edit schema</strong></span> to define the data
							structure in the source and target tables.</p></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="16pt"><img alt="[Note]" src="../images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>When you define the data structure for the source table, column names
						automatically appear in the <span class="bold"><strong>Column</strong></span> list in
						the <span class="bold"><strong>Column filters</strong></span> panel.</p></td></tr></table></div><p>In this scenario, the source table has five columns: <span class="emphasis"><em>id, First_Name,
						Last_Name, Address, </em></span>and <span class="emphasis"><em>id_State</em></span>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the <span class="bold"><strong>Column filters</strong></span> panel, set the
							column filter by selecting the check boxes of the columns you want to
							write in the source table.</p></li></ul></div><p>In this scenario, the <span class="bold"><strong>tSQLTemplateFilterColumns
					</strong></span>component instantiates only three columns: <span class="emphasis"><em>id, First_Name,
					</em></span>and <span class="emphasis"><em>id_State </em></span>from the source table.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="16pt"><img alt="[Note]" src="../images/note.png"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>In the <span class="bold"><strong>Component </strong></span>view, you can click the
							<span class="bold"><strong>SQL Template</strong></span> tab and add system SQL
						templates or create your own and use them within your Job to carry out the
						coded operation. For more information, see <a class="xref" href="tSQLTemplateFilterColumns.html#Raa83276-dup-2" title="tSQLTemplateFilterColumns Properties">the section called &#8220;tSQLTemplateFilterColumns Properties&#8221;</a>.</p></td></tr></table></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the design workspace, select <span class="bold"><strong>tSQLTemplateFilterRows</strong></span> and click the <span class="bold"><strong>Component</strong></span> tab to define its basic
							settings.</p></li></ul></div><div class="mediaobject"><img src="../images/Use_Case_tSQLTemplateAggregate4.png"></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>On the <span class="bold"><strong>Database type</strong></span> list, select the
							relevant database.</p></li><li class="listitem"><p>On the <span class="bold"><strong>Component list</strong></span>, select the
							relevant database connection component if more than one connection is
							used.</p></li><li class="listitem"><p>Enter the names for the database, source table, and target table in
							the corresponding fields and click the three-dot buttons next to
								<span class="bold"><strong>Edit schema</strong></span> to define the data
							structure in the source and target tables.</p></li></ul></div><p>In this scenario, the source table has the three initially instantiated
					columns: <span class="emphasis"><em>id, First_Name, </em></span>and <span class="emphasis"><em>id_State
					</em></span>and the source table has the same three-column schema.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the <span class="bold"><strong>Where condition</strong></span> field, enter a
							WHERE clause to extract only those records that fulfill the specified
							criterion.</p></li></ul></div><p>In this scenario, the <span class="bold"><strong>tSQLTemplateFilterRows
					</strong></span>component filters the <span class="emphasis"><em>First_Name </em></span>column in the
					source table to extract only the first names that contain the &#8220;a&#8221; letter.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the design workspace, select <span class="bold"><strong>tSQLTemplateAggregate</strong></span> and click the <span class="bold"><strong>Component</strong></span> tab to define its basic
							settings.</p></li><li class="listitem"><p>On the <span class="bold"><strong>Database type</strong></span> list, select the
							relevant database.</p></li><li class="listitem"><p>On the <span class="bold"><strong>Component list</strong></span>, select the
							relevant database connection component if more than one connection is
							used.</p></li><li class="listitem"><p>Enter the names for the database, source table, and target table in
							the corresponding fields and click the three-dot buttons next to
								<span class="bold"><strong>Edit schema</strong></span> to define the data
							structure in the source and target tables.</p></li></ul></div><p>The schema for the source table consists of the three columns: <span class="emphasis"><em>id,
						First_Name, </em></span>and <span class="emphasis"><em>id_State.</em></span> The schema for the
					target table consists of two columns: <span class="emphasis"><em>customers_status</em></span> and
						<span class="emphasis"><em>customers_number.</em></span> In this scenario, we want to group
					customers by their marital status and count customer number in each marital
					group. To do that, we define the <span class="bold"><strong>Operations</strong></span> and
						<span class="bold"><strong>Group by</strong></span> panels accordingly.</p><div class="mediaobject"><img src="../images/Use_Case_tSQLTemplateAggregate5.png"></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>In the <span class="bold"><strong>Operations</strong></span> panel, click the
							plus button to add one or more lines and then click in the <span class="bold"><strong>Output column</strong></span> line to select the output
							column that will hold the counted data. </p></li><li class="listitem"><p>Click in the <span class="bold"><strong>Function</strong></span> line and select
							the operation to be carried on.</p></li><li class="listitem"><p>In the <span class="bold"><strong>Group by</strong></span> panel, click the plus
							button to add one or more lines and then click in the <span class="bold"><strong>Output column </strong></span>line to select the output
							column that will hold the aggregated data.</p></li><li class="listitem"><p>In the design workspace, select <span class="bold"><strong>tSQLTemplateCommit</strong></span> and click the <span class="bold"><strong>Component</strong></span> tab to define its basic settings.</p></li><li class="listitem"><p>On the <span class="bold"><strong>Database type</strong></span> list, select the
							relevant database.</p></li><li class="listitem"><p>On the <span class="bold"><strong>Component list</strong></span>, select the
							relevant database connection component if more than one connection is
							used.</p></li><li class="listitem"><p>Do the same for <span class="bold"><strong>tSQLTemplateRollback</strong></span>.</p></li><li class="listitem"><p>Save your Job and press <span class="bold"><strong>F6</strong></span> to execute
							it.</p></li></ul></div><p>A two-column table <span class="emphasis"><em>aggregate_customers</em></span> is created in the
					database. It groups customers according to their marital status and count
					customer number in each marital group.</p><div class="mediaobject"><img src="../images/Aggregate_Job_Result.png"></div></div></div></body></html>